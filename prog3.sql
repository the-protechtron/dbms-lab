-- ------- TABLE CREATION -------

-- ACTOR table
CREATE TABLE ACTOR (
    ACT_ID INT PRIMARY KEY,
    ACT_NAME VARCHAR(50),
    ACT_GENDER CHAR(1)
);

-- DIRECTOR table
CREATE TABLE DIRECTOR (
    DIR_ID INT PRIMARY KEY,
    DIR_NAME VARCHAR(50),
    DIR_PHONE VARCHAR(20)
);

-- MOVIES table
CREATE TABLE MOVIES (
    MOV_ID INT PRIMARY KEY,
    MOV_TITLE VARCHAR(50),
    MOV_YEAR INT,
    MOV_LANG VARCHAR(20),
    DIR_ID INT,
    FOREIGN KEY (DIR_ID) REFERENCES DIRECTOR(DIR_ID) ON DELETE CASCADE
);

-- MOVIE_CAST table
CREATE TABLE MOVIE_CAST (
    ACT_ID INT,
    MOV_ID INT,
    ROLE VARCHAR(50),
    FOREIGN KEY (ACT_ID) REFERENCES ACTOR(ACT_ID) ON DELETE CASCADE,
    FOREIGN KEY (MOV_ID) REFERENCES MOVIES(MOV_ID) ON DELETE CASCADE,
    PRIMARY KEY (ACT_ID, MOV_ID)
);

-- RATING table
CREATE TABLE RATING (
    MOV_ID INT PRIMARY KEY,
    REV_STARS INT,
    FOREIGN KEY (MOV_ID) REFERENCES MOVIES(MOV_ID) ON DELETE CASCADE
);

-- ------- DATA INSERTION -------

-- ACTOR data
INSERT INTO ACTOR VALUES (301, 'ANUSHKA', 'F');
INSERT INTO ACTOR VALUES (302, 'PRABHAS', 'M');
INSERT INTO ACTOR VALUES (303, 'PUNITH', 'M');
INSERT INTO ACTOR VALUES (304, 'JERMY', 'M');

-- DIRECTOR data
INSERT INTO DIRECTOR VALUES (60, 'RAJAMOULI', '8751611001');
INSERT INTO DIRECTOR VALUES (61, 'HITCHCOCK', '7766138911');
INSERT INTO DIRECTOR VALUES (62, 'FARAN', '9986776531');
INSERT INTO DIRECTOR VALUES (63, 'STEVEN SPIELBERG', '8989776530');

-- MOVIES data
INSERT INTO MOVIES VALUES (1001, 'BAHUBALI-2', 2017, 'TELUGU', 60);
INSERT INTO MOVIES VALUES (1002, 'BAHUBALI-1', 2015, 'TELUGU', 60);
INSERT INTO MOVIES VALUES (1003, 'AKASH', 2008, 'KANNADA', 61);
INSERT INTO MOVIES VALUES (1004, 'WAR HORSE', 2011, 'ENGLISH', 63);

-- MOVIE_CAST data
INSERT INTO MOVIE_CAST VALUES (301, 1002, 'HEROINE');
INSERT INTO MOVIE_CAST VALUES (301, 1001, 'HEROINE');
INSERT INTO MOVIE_CAST VALUES (303, 1003, 'HERO');
INSERT INTO MOVIE_CAST VALUES (303, 1002, 'GUEST');
INSERT INTO MOVIE_CAST VALUES (304, 1004, 'HERO');

-- RATING data
INSERT INTO RATING VALUES (1001, 4);
INSERT INTO RATING VALUES (1002, 2);
INSERT INTO RATING VALUES (1003, 5);
INSERT INTO RATING VALUES (1004, 4);

-- ------- QUERIES -------

-- Q1: Movie titles directed by 'HITCHCOCK'
SELECT MOV_TITLE
FROM MOVIES
WHERE DIR_ID = (
    SELECT DIR_ID 
    FROM DIRECTOR
    WHERE DIR_NAME = 'HITCHCOCK'
);

-- Q2: Movie titles where actors acted in more than one movie
SELECT DISTINCT M.MOV_TITLE
FROM MOVIES M
JOIN MOVIE_CAST C ON M.MOV_ID = C.MOV_ID
WHERE C.ACT_ID IN (
    SELECT ACT_ID
    FROM MOVIE_CAST
    GROUP BY ACT_ID
    HAVING COUNT(DISTINCT MOV_ID) > 1
);

-- Q3: Actors in at least one movie before 2000 and after 2015
SELECT DISTINCT A.ACT_NAME
FROM ACTOR A
WHERE A.ACT_ID IN (
    SELECT C1.ACT_ID
    FROM MOVIE_CAST C1
    JOIN MOVIES M1 ON C1.MOV_ID = M1.MOV_ID
    WHERE M1.MOV_YEAR < 2000
)
AND A.ACT_ID IN (
    SELECT C2.ACT_ID
    FROM MOVIE_CAST C2
    JOIN MOVIES M2 ON C2.MOV_ID = M2.MOV_ID
    WHERE M2.MOV_YEAR > 2015
);

-- Q4: Movie titles with their highest review stars, ordered by title
SELECT MOV_TITLE, REV_STARS
FROM MOVIES M
JOIN RATING R ON M.MOV_ID = R.MOV_ID
ORDER BY MOV_TITLE;

-- Q5: Update ratings to 5 for movies directed by 'STEVEN SPIELBERG'
UPDATE RATING
SET REV_STARS = 5
WHERE MOV_ID IN (
    SELECT MOV_ID
    FROM MOVIES
    WHERE DIR_ID = (
        SELECT DIR_ID
        FROM DIRECTOR
        WHERE DIR_NAME = 'STEVEN SPIELBERG'
    )
);
